(function(f,m){"object"===typeof exports&&"undefined"!==typeof module?module.exports=m():"function"===typeof define&&define.amd?define(m):f.tvunna=m()})(this,function(){function f(a){w&&window.console.log(a)}function m(){f("Connected");for(d.listenTopicOut&&l.subscribe(d.topicOut);0!=r.length;)x(r.shift())}function z(a){f("Connection Attempt to Host "+d.host+" Failed");setTimeout(c.MQTTconnect,1E3*d.reconnectTimeout)}function A(a){0!==a.errorCode&&f("onConnectionLost:"+a.errorMessage);c.MQTTconnect()}
function x(a){setTimeout(function(){var b=new Paho.MQTT.Message(a);b.destinationName=d.topicIn;b.qos=d.qos;l.send(b);f("Message sent to : "+d.host+":"+d.port+" : "+a)},0)}function n(a){a=JSON.stringify(a);l.isConnected()?x(a):r.push(a)}function s(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255]+"-"+e[b&255]+e[b>>8&255]+"-"+e[b>>16&15|64]+e[b>>24&255]+"-"+e[c&63|128]+e[c>>
8&255]+"-"+e[c>>16&255]+e[c>>24&255]+e[d&255]+e[d>>8&255]+e[d>>16&255]+e[d>>24&255]}function B(a){"interactive"===document.readyState||"complete"===document.readyState?a():document.addEventListener("DOMContentLoaded",a)}function g(a){return a&&0<a.length?a:null}function t(a){for(;a&&a!==document;a=a.parentNode)if(a.hasAttribute("data-section"))return a.getAttribute("data-section");return null}function u(a,b,c){document.addEventListener(a,function(a){var d;d=a.target;var e=d.matches||d.matchesSelector||
d.mozMatchesSelector||d.msMatchesSelector||d.oMatchesSelector||d.webkitMatchesSelector;e?d=e.apply(d,[b]):(f('log("Unable to match")'),d=!1);d&&c(a)})}function p(a,b){!1===d.cookies?(f("Visit tracking disabled"),h=k=null):(k||(k=c.getCookie("tvunna_visit")),h||(h=c.getCookie("tvunna_visitor")),k&&h?f("Active visit"):(!k&&d.cookiesGenerate&&(k=s(),c.setCookie("tvunna_visit",k,C)),c.getCookie("tvunna_visit")?(f("Visit started"),!h&&d.cookiesGenerate&&(h=s(),c.setCookie("tvunna_visitor",h,D))):f("Cookies disabled")));
return{app_id:d.app_id,event_id:s(),event_name:a,sent_tstamp:new Date,visit_id:k,visitor_id:h,landing_page:window.location.href,title:g(document.title),referrer:g(document.referrer),user_agent:navigator.userAgent,href:null,tag:null,id:null,text:null,class_name:null,section:null,properties:b||{},mqtt_client_id:y}}var d={host:"tvunna.io",port:8443,useSSL:!0,timeout:3,reconnectTimeout:2,qos:0,topicIn:"tvunna/in",topicOut:"tvunna/out",listenTopicOut:!1,cookies:!0,cookiesGenerate:!1,app_id:"demo-js",event_type:"js",
event_type_custom:"js-api"},c=window.tvunna||window.Tvunna||{},l,r=[],k,h,C=30,D=1051200,y="js-"+(Math.random().toString(36)+"000000000000").substr(2,11),v={set:function(a,b,d,c){var e="",f="";d&&(e=new Date,e.setTime(e.getTime()+6E4*d),e="; expires="+e.toGMTString());c&&(f="; domain="+c);document.cookie=a+"="+escape(b)+e+f+"; SameSite=None; Secure; path=/"},get:function(a){var b,d=a+"=",c=document.cookie.split(";");for(a=0;a<c.length;a++){for(b=c[a];" "===b.charAt(0);)b=b.substring(1,b.length);if(0===
b.indexOf(d))return unescape(b.substring(d.length,b.length))}return null}};c.setCookie=function(a,b,c){v.set(a,b,c,d.cookieDomain||d.domain)};c.getCookie=function(a){return v.get(a)};c.destroyCookie=function(a){v.set(a,"",-1)};c.configure=function(a){for(var b in a)a.hasOwnProperty(b)&&(d[b]=a[b])};c.configure(c);var w=c.getCookie("tvunna_debug");c.MQTTconnect=function(){var a=y,b={useSSL:d.useSSL,timeout:d.timeout,onSuccess:m,onFailure:z};f("connecting to: "+d.host+":"+d.port+", clientId: "+a);l=
new Paho.MQTT.Client(d.host,d.port,a);d.listenTopicOut&&(l.onMessageArrived=onMessageArrived);l.onConnectionLost=A;l.connect(b)};for(var e=[],q=0;256>q;q++)e[q]=(16>q?"0":"")+q.toString(16);c.reset=function(){c.destroyCookie("tvunna_visit");c.destroyCookie("tvunna_visitor");return!0};c.debug=function(a){!1===a?c.destroyCookie("tvunna_debug"):c.setCookie("tvunna_debug","t",525600);w=c.getCookie("tvunna_debug");return!0};c.track=function(a,b){var c=p(a,b);c.event_type=d.event_type_custom;f("tvunna.track");
n(c);return!0};c.trackView=function(){B(function(){var a=p("pageView");a.event_type=d.event_type;f("tvunna.trackView");n(a)})};c.trackClicks=function(){u("click","a, button, input[type=submit], img",function(a){a=a.target;var b=p("click");b.event_type=d.event_type;b.tag=g(a.tagName.toLowerCase());b.href=g("img"==b.tag?a.parentNode.href:a.href);b.id=g(a.id);b.text=g("input"==b.tag?a.value:(a.textContent||a.innerText||a.innerHTML).replace(/[\s\r\n]+/g," ").trim());b.class_name=g(a.className);b.section=
t(a);f("tvunna.trackClicks");n(b)})};c.trackSubmits=function(){u("submit","form",function(a){a=a.target;var b=p("submit");b.event_type=d.event_type;b.href=g(a.href);b.tag=g(a.tagName.toLowerCase());b.id=g(a.id);b.class_name=g(a.className);b.section=t(a);f("tvunna.trackSubmits");n(b)})};c.trackChanges=function(){u("change","input, textarea, select",function(a){a=a.target;var b=p("change");b.event_type=d.event_type;b.href=g(a.href);b.tag=g(a.tagName.toLowerCase());b.id=g(a.id);b.text=g("input"==b.tag?
a.value:(a.textContent||a.innerText||a.innerHTML).replace(/[\s\r\n]+/g," ").trim());b.class_name=g(a.className);b.section=t(a);f("tvunna.trackChanges");n(b)})};c.trackAll=function(){c.trackView();c.trackClicks();c.trackSubmits();c.trackChanges()};return c});
