(function(e,n){"object"===typeof exports&&"undefined"!==typeof module?module.exports=n():"function"===typeof define&&define.amd?define(n):e.tvunna=n()})(this,function(){function e(a){x&&window.console.log(a)}function n(){e("Connected");for(d.listenTopicOut&&m.subscribe(d.topicOut);0!=s.length;)y(s.shift())}function A(a){e("Connection Attempt to Host "+d.host+" Failed");setTimeout(b.MQTTconnect,1E3*d.reconnectTimeout)}function B(a){0!==a.errorCode&&e("onConnectionLost:"+a.errorMessage);b.MQTTconnect()}
function y(a){setTimeout(function(){var f=new Paho.MQTT.Message(a);f.destinationName=d.topicIn;f.qos=d.qos;m.send(f);e("Message sent to : "+d.host+":"+d.port+" : "+a)},0)}function p(a){a=JSON.stringify(a);m.isConnected()?y(a):s.push(a)}function t(){var a=4294967295*Math.random()|0,f=4294967295*Math.random()|0,c=4294967295*Math.random()|0,b=4294967295*Math.random()|0;return g[a&255]+g[a>>8&255]+g[a>>16&255]+g[a>>24&255]+"-"+g[f&255]+g[f>>8&255]+"-"+g[f>>16&15|64]+g[f>>24&255]+"-"+g[c&63|128]+g[c>>
8&255]+"-"+g[c>>16&255]+g[c>>24&255]+g[b&255]+g[b>>8&255]+g[b>>16&255]+g[b>>24&255]}function C(a){"interactive"===document.readyState||"complete"===document.readyState?a():document.addEventListener("DOMContentLoaded",a)}function h(a){return a&&0<a.length?a:null}function u(a,f,c){document.addEventListener(a,function(a){var b;b=a.target;var d=b.matches||b.matchesSelector||b.mozMatchesSelector||b.msMatchesSelector||b.oMatchesSelector||b.webkitMatchesSelector;d?b=d.apply(b,[f]):(e('log("Unable to match")'),
b=!1);b&&c(a)})}function q(a,f){!1===d.cookies?(e("Visit tracking disabled"),k=l=null):(l||(l=b.getCookie("tvunna_visit")),k||(k=b.getCookie("tvunna_visitor")),l&&k?e("Active visit"):(!l&&d.cookiesGenerate&&(l=t(),b.setCookie("tvunna_visit",l,D)),b.getCookie("tvunna_visit")?(e("Visit started"),!k&&d.cookiesGenerate&&(k=t(),b.setCookie("tvunna_visitor",k,E))):e("Cookies disabled")));return{time:{sent_tstamp:new Date},tvunna_config:{app_id:d.app_id,connector_id:d.connector_id,connector_name:d.connector_name,
integration_api:d.integration_api,integration_lang:d.integration_lang,integration_type:d.integration_type,version:d.version},event:{keys:{event_id:t(),source_event_name:a},data:{}},person:{keys:{visitor_id:k,user_id:""},data:{}},items:{keys:{},data:{}},context:{keys:{visit_id:l,tracker_id:""},data:{}},captured_data_payload:{properties:f||{},dataset:{},landing_page:window.location.href,title:h(document.title),referrer:h(document.referrer),user_agent:navigator.userAgent,href:null,tag:null,id:null,text:null,
class_name:null,mqtt_client_id:z}}}function v(a,f){"user_id"in f.dataset&&(a.person.keys.user_id=f.dataset.user_id);"tracker_id"in f.dataset&&(a.context.keys.tracker_id=f.dataset.tracker_id);"source_event_name"in f.dataset&&(a.event.keys.source_event_name=f.dataset.source_event_name)}var d={host:"tvunna.io",port:8443,useSSL:!0,timeout:3,reconnectTimeout:2,qos:0,topicIn:"tvunna/in",topicOut:"tvunna/out",listenTopicOut:!1,cookies:!0,cookiesGenerate:!1,app_id:"demo-js",connector_id:"0",connector_name:"javascript",
integration_api:!1,integration_lang:"js",integration_type:"client",version:"1"},b=window.tvunna||window.Tvunna||{},m,s=[],l,k,D=30,E=1051200,z="js-"+(Math.random().toString(36)+"000000000000").substr(2,11),w={set:function(a,f,b,d){var e="",g="";b&&(e=new Date,e.setTime(e.getTime()+6E4*b),e="; expires="+e.toGMTString());d&&(g="; domain="+d);document.cookie=a+"="+escape(f)+e+g+"; SameSite=None; Secure; path=/"},get:function(a){var b,c=a+"=",d=document.cookie.split(";");for(a=0;a<d.length;a++){for(b=
d[a];" "===b.charAt(0);)b=b.substring(1,b.length);if(0===b.indexOf(c))return unescape(b.substring(c.length,b.length))}return null}};b.setCookie=function(a,b,c){w.set(a,b,c,d.cookieDomain||d.domain)};b.getCookie=function(a){return w.get(a)};b.destroyCookie=function(a){w.set(a,"",-1)};b.configure=function(a){for(var b in a)a.hasOwnProperty(b)&&(d[b]=a[b])};b.configure(b);var x=b.getCookie("tvunna_debug");b.MQTTconnect=function(){var a=z,b={useSSL:d.useSSL,timeout:d.timeout,onSuccess:n,onFailure:A};
e("connecting to: "+d.host+":"+d.port+", clientId: "+a);m=new Paho.MQTT.Client(d.host,d.port,a);d.listenTopicOut&&(m.onMessageArrived=onMessageArrived);m.onConnectionLost=B;m.connect(b)};for(var g=[],r=0;256>r;r++)g[r]=(16>r?"0":"")+r.toString(16);b.track=function(a,b){var c=q(a,b);e("tvunna.track");p(c);return c.event.keys.event_id};b.trackView=function(){C(function(){var a=q("pageViewJS");e("tvunna.trackView");p(a)})};b.trackClicks=function(){u("click","a, button, input[type=submit], img",function(a){a=
a.target;var b=q("clickJS"),c=b.captured_data_payload;c.tag=h(a.tagName.toLowerCase());"img"==c.tag?(c.href=h(a.parentNode.href),c.dataset=a.parentNode.dataset):(c.href=h(a.href),c.dataset=a.dataset);c.id=h(a.id);c.class_name=h(a.className);c.text=h("input"==c.tag?a.value:(a.textContent||a.innerText||a.innerHTML).replace(/[\s\r\n]+/g," ").trim());v(b,c);e("tvunna.trackClicks");p(b)})};b.trackSubmits=function(){u("submit","form",function(a){a=a.target;var b=q("submitJS"),c=b.captured_data_payload;
c.tag=h(a.tagName.toLowerCase());c.href=h(a.href);c.dataset=a.dataset;c.id=h(a.id);c.class_name=h(a.className);v(b,c);e("tvunna.trackSubmits");p(b)})};b.trackChanges=function(){u("change","input, textarea, select",function(a){a=a.target;var b=q("changeJS"),c=b.captured_data_payload;c.tag=h(a.tagName.toLowerCase());c.href=h(a.href);c.dataset=a.dataset;c.id=h(a.id);c.class_name=h(a.className);c.text=h(a.value);v(b,c);e("tvunna.trackChanges");p(b)})};b.trackAll=function(){b.trackView();b.trackClicks();
b.trackSubmits();b.trackChanges()};b.reset=function(){b.destroyCookie("tvunna_visit");b.destroyCookie("tvunna_visitor");return!0};b.debug=function(a){!1===a?b.destroyCookie("tvunna_debug"):b.setCookie("tvunna_debug","t",525600);x=b.getCookie("tvunna_debug");return!0};return b});
